SHELL = /bin/sh
VPATH = @srcdir@

top_srcdir = @top_srcdir@
srcdir = @srcdir@
prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = $(exec_prefix)/bin

CXX = @CXX@
CXXFLAGS = @CXXFLAGS@ @BOOST_CXXFLAGS@ -I/usr/local/include/thrift -I../gen-cpp `/usr/local/libxml2/bin/xml2-config --cflags` -c
LDFLAGS = -L/usr/local/libxml2/lib -L/usr/local/lib @LDFLAGS@ @BOOST_LDFLAGS@ -g
LIBS = @LIBS@ -lboost_program_options -lboost_thread -lpcrecpp -Wl,-Bstatic -lxml2 -Wl,-Bdynamic -lthrift -lm -lz -g 

GEN_SRC = ../gen-cpp/verb_types.cpp ../gen-cpp/VerbDb.cpp
OBJS = context.o logger.o main.o query.o reaper.o response.o session.o site.o util.o verb_db_handler.o verb_types.o VerbDb.o
HEADERS = context.h logger.h query.h reaper.h response.h session.h site.h util.h verb_db_handler.h ../gen-cpp/verb_types.h ../gen-cpp/verb_constants.h ../gen-cpp/VerbDb.h
	
default: server

clean:
	$(RM) verbdb *.o

context.o: context.cpp ${HEADERS}
	${CXX} ${CXXFLAGS} context.cpp

install: server
	svc -d /service/verbdbd
	sleep 2
	cp verbdb /usr/local/bin
	svc -u /service/verbdbd
	
logger.o: logger.cpp ${HEADERS}
	${CXX} ${CXXFLAGS} logger.cpp
	
main.o: main.cpp ${HEADERS}
	${CXX} ${CXXFLAGS} main.cpp
	
query.o: query.cpp ${HEADERS}
	${CXX} ${CXXFLAGS} query.cpp

patch:
	patch ../gen-cpp/verb_types.h < verb_types.h.patch

reaper.o: reaper.cpp ${HEADERS}
	${CXX} ${CXXFLAGS} reaper.cpp

response.o: response.cpp ${HEADERS}
	${CXX} ${CXXFLAGS} response.cpp
	
server: ${OBJS}
	${CXX} -o verbdb ${OBJS} ${LDFLAGS} ${LIBS}
	
session.o: session.cpp ${HEADERS}
	${CXX} ${CXXFLAGS} session.cpp
	
site.o: site.cpp ${HEADERS}
	${CXX} ${CXXFLAGS} site.cpp
	
util.o: util.cpp ${HEADERS}
	${CXX} ${CXXFLAGS} util.cpp
	
verb_db_handler.o: verb_db_handler.cpp ${HEADERS}
	${CXX} ${CXXFLAGS} verb_db_handler.cpp
	
verb_types.o: ../gen-cpp/verb_types.cpp ../gen-cpp/verb_types.h
	${CXX} ${CXXFLAGS} ../gen-cpp/verb_types.cpp 
	
VerbDb.o: ../gen-cpp/VerbDb.cpp ../gen-cpp/VerbDb.h
	${CXX} ${CXXFLAGS} ../gen-cpp/VerbDb.cpp
